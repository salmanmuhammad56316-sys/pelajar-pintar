<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PELAJAR PINTAR - Smart Student Life OS</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        :root {
            /* Light Theme */
            --primary-color: #2563eb;
            --secondary-color: #7c3aed;
            --background-color: #f5f7fb;
            --surface-color: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #3b82f6;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius: 12px;
            --radius-lg: 16px;
            --transition: all 0.3s ease;
        }
        
        .dark-mode {
            /* Dark Theme */
            --primary-color: #3b82f6;
            --secondary-color: #8b5cf6;
            --background-color: #111827;
            --surface-color: #1f2937;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --border-color: #374151;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            transition: var(--transition);
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        .app-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: 260px;
            background-color: var(--surface-color);
            box-shadow: var(--shadow);
            position: fixed;
            height: 100vh;
            z-index: 100;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 20px;
        }
        
        .app-name {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .sidebar-nav {
            padding: 20px 0;
            flex-grow: 1;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 24px;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-secondary);
            text-decoration: none;
        }
        
        .nav-item:hover {
            background-color: rgba(37, 99, 235, 0.1);
            color: var(--primary-color);
        }
        
        .nav-item.active {
            background-color: rgba(37, 99, 235, 0.1);
            color: var(--primary-color);
            border-right: 4px solid var(--primary-color);
        }
        
        .nav-item i {
            width: 20px;
            height: 20px;
        }
        
        .nav-item span {
            font-weight: 500;
        }
        
        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
        
        .user-name {
            font-weight: 600;
            font-size: 14px;
        }
        
        /* Main Content Styles */
        .main-content {
            flex-grow: 1;
            margin-left: 260px;
            transition: var(--transition);
        }
        
        /* Header Styles */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background-color: var(--surface-color);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 90;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            width: 24px;
            height: 24px;
        }
        
        .search-container {
            position: relative;
            width: 300px;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 20px 12px 44px;
            border-radius: 50px;
            border: 1px solid var(--border-color);
            background-color: var(--background-color);
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
            transition: var(--transition);
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .theme-toggle {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-primary);
            width: 24px;
            height: 24px;
        }
        
        .notification-btn {
            position: relative;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-primary);
            width: 24px;
            height: 24px;
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 8px;
            height: 8px;
            background-color: var(--danger-color);
            border-radius: 50%;
        }
        
        .quick-add-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }
        
        .quick-add-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        /* Content Area Styles */
        .content-area {
            padding: 30px;
        }
        
        .page-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .page-subtitle {
            color: var(--text-secondary);
            margin-bottom: 30px;
        }
        
        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 24px;
            margin-bottom: 30px;
        }
        
        .card {
            background-color: var(--surface-color);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .card-actions {
            display: flex;
            gap: 8px;
        }
        
        .card-action-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            width: 20px;
            height: 20px;
        }
        
        /* Widget Sizes */
        .widget-small {
            grid-column: span 3;
        }
        
        .widget-medium {
            grid-column: span 6;
        }
        
        .widget-large {
            grid-column: span 9;
        }
        
        .widget-full {
            grid-column: span 12;
        }
        
        /* Stats Cards */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background-color: var(--surface-color);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
        }
        
        .stat-icon.primary {
            background-color: rgba(37, 99, 235, 0.1);
            color: var(--primary-color);
        }
        
        .stat-icon.success {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }
        
        .stat-icon.warning {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
        }
        
        .stat-icon.danger {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        /* Task List */
        .task-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .task-item {
            display: flex;
            align-items: center;
            padding: 16px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }
        
        .task-item:hover {
            border-color: var(--primary-color);
            background-color: rgba(37, 99, 235, 0.05);
        }
        
        .task-checkbox {
            width: 20px;
            height: 20px;
            border-radius: 6px;
            border: 2px solid var(--border-color);
            margin-right: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .task-checkbox.checked {
            background-color: var(--success-color);
            border-color: var(--success-color);
            color: white;
        }
        
        .task-info {
            flex-grow: 1;
        }
        
        .task-title {
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .task-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .task-priority {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .priority-low {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }
        
        .priority-medium {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
        }
        
        .priority-high {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }
        
        .task-deadline {
            font-size: 14px;
            color: var(--text-secondary);
            margin-left: 16px;
        }
        
        /* Schedule Table */
        .schedule-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .schedule-table th {
            text-align: left;
            padding: 16px;
            border-bottom: 2px solid var(--border-color);
            color: var(--text-secondary);
            font-weight: 600;
        }
        
        .schedule-table td {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .schedule-table tr:hover td {
            background-color: rgba(37, 99, 235, 0.05);
        }
        
        .today {
            background-color: rgba(37, 99, 235, 0.1);
        }
        
        /* Habit Tracker */
        .habit-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .habit-item {
            display: flex;
            align-items: center;
            padding: 16px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }
        
        .habit-name {
            font-weight: 500;
            flex-grow: 1;
        }
        
        .habit-streak {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-right: 20px;
        }
        
        .streak-count {
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .habit-checkbox {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            border: 2px solid var(--border-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .habit-checkbox.checked {
            background-color: var(--success-color);
            border-color: var(--success-color);
            color: white;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--background-color);
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
            transition: var(--transition);
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .form-select {
            width: 100%;
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--background-color);
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
            transition: var(--transition);
        }
        
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .btn-secondary {
            background-color: var(--surface-color);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            background-color: var(--background-color);
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background-color: var(--surface-color);
            border-radius: var(--radius-lg);
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            transform: translateY(20px);
            transition: var(--transition);
        }
        
        .modal-overlay.active .modal {
            transform: translateY(0);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 700;
        }
        
        .modal-close {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            width: 24px;
            height: 24px;
        }
        
        /* Toast Notification */
        .toast-container {
            position: fixed;
            top: 30px;
            right: 30px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .toast {
            background-color: var(--surface-color);
            border-radius: var(--radius);
            padding: 16px 24px;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            transform: translateX(100%);
            opacity: 0;
            transition: var(--transition);
        }
        
        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .toast-success {
            border-left: 4px solid var(--success-color);
        }
        
        .toast-warning {
            border-left: 4px solid var(--warning-color);
        }
        
        .toast-error {
            border-left: 4px solid var(--danger-color);
        }
        
        .toast-info {
            border-left: 4px solid var(--info-color);
        }
        
        /* Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 30px;
            text-align: center;
        }
        
        .empty-state-icon {
            width: 100px;
            height: 100px;
            background-color: var(--background-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
            color: var(--text-secondary);
        }
        
        .empty-state-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 12px;
        }
        
        .empty-state-description {
            color: var(--text-secondary);
            margin-bottom: 24px;
            max-width: 400px;
        }
        
        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Notification Panel */
        .notification-panel {
            position: fixed;
            top: 80px;
            right: 30px;
            background-color: var(--surface-color);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            width: 350px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: var(--transition);
        }
        
        .notification-panel.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .notification-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
        }
        
        .notification-list {
            padding: 10px 0;
        }
        
        .notification-item {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: flex-start;
            gap: 12px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .notification-item:hover {
            background-color: rgba(37, 99, 235, 0.05);
        }
        
        .notification-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }
        
        .notification-content {
            flex-grow: 1;
        }
        
        .notification-title {
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .notification-time {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        /* Mobile Navigation */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--surface-color);
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 90;
            padding: 10px 0;
        }
        
        .mobile-nav-list {
            display: flex;
            justify-content: space-around;
            list-style: none;
        }
        
        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--text-secondary);
            font-size: 12px;
            padding: 8px;
            border-radius: 8px;
            transition: var(--transition);
        }
        
        .mobile-nav-item.active {
            color: var(--primary-color);
            background-color: rgba(37, 99, 235, 0.1);
        }
        
        .mobile-nav-item i {
            width: 20px;
            height: 20px;
            margin-bottom: 4px;
        }
        
        /* Login Styles */
        .login-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }
        
        .login-card {
            background-color: var(--surface-color);
            border-radius: var(--radius-lg);
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: var(--shadow-lg);
            text-align: center;
        }
        
        .login-logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 32px;
            margin: 0 auto 24px;
        }
        
        .login-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .login-subtitle {
            color: var(--text-secondary);
            margin-bottom: 32px;
        }
        
        .login-form {
            width: 100%;
        }
        
        .login-input {
            width: 100%;
            padding: 16px 20px;
            border-radius: 12px;
            border: 2px solid var(--border-color);
            background-color: var(--background-color);
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
            font-size: 16px;
            margin-bottom: 20px;
            transition: var(--transition);
        }
        
        .login-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
        }
        
        .login-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 12px;
            font-family: 'Poppins', sans-serif;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .login-btn:active {
            transform: translateY(0);
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .widget-small {
                grid-column: span 6;
            }
            
            .widget-medium, .widget-large {
                grid-column: span 12;
            }
            
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .menu-toggle {
                display: block;
            }
            
            .search-container {
                width: 200px;
            }
            
            .widget-small, .widget-medium, .widget-large {
                grid-column: span 12;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .header {
                padding: 15px 20px;
            }
            
            .content-area {
                padding: 20px;
            }
            
            .mobile-nav {
                display: block;
            }
            
            .page-title {
                font-size: 24px;
            }
            
            .login-card {
                padding: 30px 20px;
            }
        }
        
        @media (max-width: 480px) {
            .search-container {
                width: 150px;
            }
            
            .header-right {
                gap: 10px;
            }
            
            .quick-add-btn {
                width: 40px;
                height: 40px;
            }
            
            .modal {
                width: 95%;
                padding: 20px;
            }
        }
        
        /* Utility Classes */
        .hidden {
            display: none !important;
        }
        
        .text-center {
            text-align: center;
        }
        
        .mb-10 {
            margin-bottom: 10px;
        }
        
        .mb-20 {
            margin-bottom: 20px;
        }
        
        .mb-30 {
            margin-bottom: 30px;
        }
        
        .mt-10 {
            margin-top: 10px;
        }
        
        .mt-20 {
            margin-top: 20px;
        }
        
        .mt-30 {
            margin-top: 30px;
        }
        
        .flex {
            display: flex;
        }
        
        .flex-col {
            flex-direction: column;
        }
        
        .items-center {
            align-items: center;
        }
        
        .justify-between {
            justify-content: space-between;
        }
        
        .justify-center {
            justify-content: center;
        }
        
        .gap-10 {
            gap: 10px;
        }
        
        .gap-20 {
            gap: 20px;
        }
        
        .w-full {
            width: 100%;
        }
        
        /* Gradient Background */
        .gradient-bg {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        /* Glassmorphism Effect */
        .glassmorphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .dark-mode .glassmorphism {
            background: rgba(31, 41, 55, 0.6);
        }
        
        /* Progress Bar */
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background-color: var(--border-color);
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: width 0.5s ease;
        }
        
        /* Level Badge */
        .level-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background-color: rgba(37, 99, 235, 0.1);
            border-radius: 20px;
            color: var(--primary-color);
            font-weight: 600;
            font-size: 14px;
        }
        
        /* Filter Container */
        .filter-container {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            background-color: var(--surface-color);
            color: var(--text-primary);
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            transition: var(--transition);
        }
        
        .filter-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .filter-btn:hover:not(.active) {
            background-color: var(--background-color);
        }
        
        /* Countdown Timer */
        .countdown {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }
        
        .countdown-danger {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }
        
        .countdown-warning {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
        }
        
        .countdown-success {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }
        
        /* XP Progress */
        .xp-container {
            margin-top: 20px;
        }
        
        .xp-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .xp-current {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .xp-next {
            color: var(--text-secondary);
        }
        
        /* Login Tips */
        .login-tips {
            margin-top: 20px;
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .login-tips kbd {
            background-color: var(--background-color);
            padding: 2px 6px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            font-family: monospace;
        }
    </style>
</head>
<body class="light-mode">
    <!-- Login Screen -->
    <div class="login-container" id="loginScreen">
        <div class="login-card">
            <div class="login-logo">PP</div>
            <h1 class="login-title">PELAJAR PINTAR</h1>
            <p class="login-subtitle">Smart Student Life OS</p>
            
            <form class="login-form" id="loginForm">
                <input type="text" class="login-input" id="userNameInput" placeholder="Masukkan nama Anda" required autofocus>
                <button type="submit" class="login-btn" id="loginBtn">Masuk ke Dashboard</button>
            </form>
            
            <div class="login-tips">
                <p>Gunakan <kbd>Enter</kbd> untuk login â€¢ <kbd>Esc</kbd> untuk reset</p>
            </div>
        </div>
    </div>
    
    <!-- Main Application (Hidden until login) -->
    <div class="app-container hidden" id="appContainer">
        <!-- Sidebar Navigation -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">PP</div>
                <div class="app-name">PELAJAR PINTAR</div>
            </div>
            
            <div class="sidebar-nav">
                <a href="#" class="nav-item active" data-page="dashboard">
                    <i data-lucide="layout-dashboard"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-page="schedule">
                    <i data-lucide="calendar"></i>
                    <span>Jadwal</span>
                </a>
                <a href="#" class="nav-item" data-page="tasks">
                    <i data-lucide="check-square"></i>
                    <span>Tugas</span>
                </a>
                <a href="#" class="nav-item" data-page="habits">
                    <i data-lucide="target"></i>
                    <span>Habit</span>
                </a>
                <a href="#" class="nav-item" data-page="finance">
                    <i data-lucide="wallet"></i>
                    <span>Keuangan</span>
                </a>
                <a href="#" class="nav-item" data-page="stats">
                    <i data-lucide="bar-chart-3"></i>
                    <span>Statistik</span>
                </a>
                <a href="#" class="nav-item" data-page="planner">
                    <i data-lucide="brain"></i>
                    <span>Smart Planner</span>
                </a>
                <a href="#" class="nav-item" data-page="settings">
                    <i data-lucide="settings"></i>
                    <span>Pengaturan</span>
                </a>
            </div>
            
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">SP</div>
                    <div>
                        <div class="user-name" id="userName">Student</div>
                        <div class="level-badge">
                            <i data-lucide="award"></i>
                            <span>Level <span id="userLevel">1</span></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Content Area -->
        <div class="main-content" id="mainContent">
            <!-- Header with Search and Notifications -->
            <div class="header">
                <div class="header-left">
                    <button class="menu-toggle" id="menuToggle">
                        <i data-lucide="menu"></i>
                    </button>
                    
                    <div class="search-container">
                        <i data-lucide="search" class="search-icon"></i>
                        <input type="text" class="search-input" id="globalSearch" placeholder="Cari tugas, mapel, habit...">
                    </div>
                </div>
                
                <div class="header-right">
                    <button class="theme-toggle" id="themeToggle">
                        <i data-lucide="moon" id="themeIcon"></i>
                    </button>
                    
                    <button class="notification-btn" id="notificationBtn">
                        <i data-lucide="bell"></i>
                        <span class="notification-badge"></span>
                    </button>
                    
                    <button class="quick-add-btn" id="quickAddBtn">
                        <i data-lucide="plus"></i>
                    </button>
                </div>
            </div>
            
            <!-- Notification Panel -->
            <div class="notification-panel" id="notificationPanel">
                <div class="notification-header">Notifikasi</div>
                <div class="notification-list" id="notificationList">
                    <!-- Notifications will be added here dynamically -->
                </div>
            </div>
            
            <!-- Content Area - Dashboard (Default) -->
            <div class="content-area">
                <div id="dashboardPage" class="page-content">
                    <h1 class="page-title">
                        <i data-lucide="layout-dashboard"></i>
                        Dashboard
                    </h1>
                    <p class="page-subtitle">Selamat datang di Smart Student Life OS! Ini adalah ringkasan aktivitas kamu hari ini.</p>
                    
                    <!-- Stats Cards -->
                    <div class="stats-container">
                        <div class="stat-card">
                            <div class="stat-icon primary">
                                <i data-lucide="book-open"></i>
                            </div>
                            <div class="stat-value" id="todayTasks">0</div>
                            <div class="stat-label">Tugas Hari Ini</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon success">
                                <i data-lucide="target"></i>
                            </div>
                            <div class="stat-value" id="completedHabits">0%</div>
                            <div class="stat-label">Habit Selesai</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon warning">
                                <i data-lucide="clock"></i>
                            </div>
                            <div class="stat-value" id="nextClass">-</div>
                            <div class="stat-label">Kelas Berikutnya</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon danger">
                                <i data-lucide="wallet"></i>
                            </div>
                            <div class="stat-value" id="currentBalance">Rp 0</div>
                            <div class="stat-label">Saldo</div>
                        </div>
                    </div>
                    
                    <!-- Dashboard Widgets -->
                    <div class="dashboard-grid">
                        <!-- Today's Schedule -->
                        <div class="card widget-medium">
                            <div class="card-header">
                                <h2 class="card-title">Jadwal Hari Ini</h2>
                                <div class="card-actions">
                                    <button class="card-action-btn" data-action="refresh-schedule">
                                        <i data-lucide="refresh-cw"></i>
                                    </button>
                                </div>
                            </div>
                            <div id="todaySchedule">
                                <div class="empty-state">
                                    <div class="empty-state-icon">
                                        <i data-lucide="calendar"></i>
                                    </div>
                                    <h3 class="empty-state-title">Tidak ada jadwal hari ini</h3>
                                    <p class="empty-state-description">Tambahkan jadwal pelajaran untuk melihatnya di sini</p>
                                    <button class="btn btn-primary" id="addScheduleBtn">Tambah Jadwal</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Upcoming Tasks -->
                        <div class="card widget-medium">
                            <div class="card-header">
                                <h2 class="card-title">Tugas Mendatang</h2>
                                <div class="card-actions">
                                    <button class="card-action-btn" data-action="filter-tasks">
                                        <i data-lucide="filter"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="task-list" id="upcomingTasks">
                                <!-- Tasks will be added here dynamically -->
                            </div>
                        </div>
                        
                        <!-- Habit Tracker -->
                        <div class="card widget-large">
                            <div class="card-header">
                                <h2 class="card-title">Habit Tracker</h2>
                                <div class="card-actions">
                                    <button class="card-action-btn" data-action="add-habit">
                                        <i data-lucide="plus"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="habit-list" id="todayHabits">
                                <!-- Habits will be added here dynamically -->
                            </div>
                        </div>
                        
                        <!-- Productivity Stats -->
                        <div class="card widget-large">
                            <div class="card-header">
                                <h2 class="card-title">Statistik Produktivitas</h2>
                                <div class="card-actions">
                                    <button class="card-action-btn" data-action="refresh-stats">
                                        <i data-lucide="refresh-cw"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="productivityChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- XP Progress -->
                        <div class="card widget-full">
                            <div class="card-header">
                                <h2 class="card-title">Progres Level</h2>
                                <div class="card-actions">
                                    <button class="card-action-btn" data-action="show-badges">
                                        <i data-lucide="award"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="xp-container">
                                <div class="xp-label">
                                    <span class="xp-current"><span id="currentXP">0</span> XP</span>
                                    <span class="xp-next"><span id="nextLevelXP">100</span> XP untuk Level <span id="nextLevel">2</span></span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="xpProgress" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Other pages will be loaded here -->
                <div id="otherPages"></div>
            </div>
        </div>
        
        <!-- Mobile Navigation -->
        <div class="mobile-nav">
            <ul class="mobile-nav-list">
                <li>
                    <a href="#" class="mobile-nav-item active" data-page="dashboard">
                        <i data-lucide="layout-dashboard"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="mobile-nav-item" data-page="schedule">
                        <i data-lucide="calendar"></i>
                        <span>Jadwal</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="mobile-nav-item" data-page="tasks">
                        <i data-lucide="check-square"></i>
                        <span>Tugas</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="mobile-nav-item" data-page="habits">
                        <i data-lucide="target"></i>
                        <span>Habit</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="mobile-nav-item" data-page="finance">
                        <i data-lucide="wallet"></i>
                        <span>Keuangan</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>
    
    <!-- Modals -->
    <div class="modal-overlay" id="quickAddModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Tambah Cepat</h2>
                <button class="modal-close" id="closeQuickAddModal">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="flex flex-col gap-20">
                    <button class="btn btn-secondary" id="addTaskQuick">
                        <i data-lucide="plus" class="mr-2"></i>
                        Tambah Tugas
                    </button>
                    <button class="btn btn-secondary" id="addHabitQuick">
                        <i data-lucide="plus" class="mr-2"></i>
                        Tambah Habit
                    </button>
                    <button class="btn btn-secondary" id="addTransactionQuick">
                        <i data-lucide="plus" class="mr-2"></i>
                        Tambah Transaksi
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="addTaskModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Tambah Tugas Baru</h2>
                <button class="modal-close" id="closeTaskModal">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="taskForm">
                    <div class="form-group">
                        <label class="form-label" for="taskTitle">Judul Tugas</label>
                        <input type="text" class="form-input" id="taskTitle" placeholder="Contoh: Mengerjakan essay sejarah" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="taskSubject">Mata Pelajaran</label>
                        <select class="form-select" id="taskSubject" required>
                            <option value="">Pilih mata pelajaran</option>
                            <option value="Matematika">Matematika</option>
                            <option value="Bahasa Indonesia">Bahasa Indonesia</option>
                            <option value="Bahasa Inggris">Bahasa Inggris</option>
                            <option value="IPA">IPA</option>
                            <option value="IPS">IPS</option>
                            <option value="Sejarah">Sejarah</option>
                            <option value="Seni Budaya">Seni Budaya</option>
                            <option value="PJOK">PJOK</option>
                            <option value="Lainnya">Lainnya</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="taskDeadline">Deadline</label>
                        <input type="datetime-local" class="form-input" id="taskDeadline" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="taskPriority">Prioritas</label>
                        <select class="form-select" id="taskPriority" required>
                            <option value="low">Rendah</option>
                            <option value="medium" selected>Sedang</option>
                            <option value="high">Tinggi</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="taskNotes">Catatan (opsional)</label>
                        <textarea class="form-input" id="taskNotes" rows="3" placeholder="Tambahkan catatan atau instruksi..."></textarea>
                    </div>
                    
                    <div class="flex justify-between mt-30">
                        <button type="button" class="btn btn-secondary" id="cancelTask">Batal</button>
                        <button type="submit" class="btn btn-primary">Simpan Tugas</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>
    
    <script>
        // Initialize Lucide Icons
        lucide.createIcons();
        
        // Application State
        const state = {
            user: {
                name: localStorage.getItem('pelajarPintarUserName') || '',
                level: parseInt(localStorage.getItem('pelajarPintarUserLevel')) || 1,
                xp: parseInt(localStorage.getItem('pelajarPintarUserXP')) || 0,
                darkMode: localStorage.getItem('pelajarPintarDarkMode') === 'true' || false
            },
            tasks: JSON.parse(localStorage.getItem('pelajarPintarTasks')) || [],
            habits: JSON.parse(localStorage.getItem('pelajarPintarHabits')) || [],
            schedule: JSON.parse(localStorage.getItem('pelajarPintarSchedule')) || [],
            transactions: JSON.parse(localStorage.getItem('pelajarPintarTransactions')) || [],
            notifications: JSON.parse(localStorage.getItem('pelajarPintarNotifications')) || []
        };
        
        // DOM Elements
        const loginScreen = document.getElementById('loginScreen');
        const appContainer = document.getElementById('appContainer');
        const loginForm = document.getElementById('loginForm');
        const userNameInput = document.getElementById('userNameInput');
        const loginBtn = document.getElementById('loginBtn');
        
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');
        const menuToggle = document.getElementById('menuToggle');
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const quickAddBtn = document.getElementById('quickAddBtn');
        const quickAddModal = document.getElementById('quickAddModal');
        const closeQuickAddModal = document.getElementById('closeQuickAddModal');
        const globalSearch = document.getElementById('globalSearch');
        const notificationBtn = document.getElementById('notificationBtn');
        const notificationPanel = document.getElementById('notificationPanel');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const userLevel = document.getElementById('userLevel');
        
        // Application flags
        let isLoggedIn = false;
        let keyboardShortcutsEnabled = false;
        
        // Initialize the application
        function initApp() {
            // Check if user has logged in before
            if (state.user.name) {
                // User already logged in, skip login screen
                loginScreen.classList.add('hidden');
                appContainer.classList.remove('hidden');
                setupUser();
                isLoggedIn = true;
                keyboardShortcutsEnabled = true;
                setupApp();
            } else {
                // Show login screen
                loginScreen.classList.remove('hidden');
                appContainer.classList.add('hidden');
                isLoggedIn = false;
                keyboardShortcutsEnabled = false;
                setupLoginScreen();
            }
        }
        
        // Set up login screen
        function setupLoginScreen() {
            // Focus on input
            userNameInput.focus();
            
            // Form submission
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                handleLogin();
            });
            
            // Login button click
            loginBtn.addEventListener('click', handleLogin);
            
            // Login with Enter key
            userNameInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    handleLogin();
                }
                
                // Disable all keyboard shortcuts except Enter and Escape
                if (e.key !== 'Enter' && e.key !== 'Escape') {
                    // Allow normal typing
                    return;
                }
                
                if (e.key === 'Escape') {
                    userNameInput.value = '';
                }
            });
            
            // Disable keyboard shortcuts globally during login
            document.addEventListener('keydown', (e) => {
                if (!isLoggedIn) {
                    // Only allow Enter for login and Escape for clearing
                    if (e.key === 'n' || e.key === '/' || (e.ctrlKey && e.key === 'k')) {
                        e.preventDefault();
                        // Focus back to input if user tries to use shortcuts
                        if (!userNameInput.contains(document.activeElement)) {
                            userNameInput.focus();
                        }
                    }
                }
            }, true); // Use capture phase to intercept early
        }
        
        // Handle login
        function handleLogin() {
            const name = userNameInput.value.trim();
            if (name) {
                state.user.name = name;
                localStorage.setItem('pelajarPintarUserName', name);
                
                // Switch to app
                loginScreen.classList.add('hidden');
                appContainer.classList.remove('hidden');
                isLoggedIn = true;
                keyboardShortcutsEnabled = true;
                
                setupUser();
                setupApp();
                showToast('Selamat datang, ' + name + '!', 'success');
            } else {
                showToast('Masukkan nama Anda terlebih dahulu', 'error');
                userNameInput.focus();
            }
        }
        
        // Set up main application
        function setupApp() {
            // Set up user display
            setupUser();
            
            // Set up event listeners
            setupEventListeners();
            
            // Initialize data
            initializeData();
            
            // Update UI
            updateDashboard();
            updateNotifications();
            
            // Set theme
            if (state.user.darkMode) {
                document.body.classList.add('dark-mode');
                document.body.classList.remove('light-mode');
                lucide.createIcons();
                themeIcon.setAttribute('data-lucide', 'sun');
                lucide.createIcons();
            }
        }
        
        // Set up user information
        function setupUser() {
            // Update user display
            userName.textContent = state.user.name;
            userLevel.textContent = state.user.level;
            
            // Create avatar initials
            const nameParts = state.user.name.split(' ');
            let initials = '';
            if (nameParts.length >= 2) {
                initials = nameParts[0].charAt(0) + nameParts[1].charAt(0);
            } else {
                initials = state.user.name.substring(0, 2);
            }
            userAvatar.textContent = initials.toUpperCase();
        }
        
        // Set up event listeners for main app
        function setupEventListeners() {
            // Menu toggle
            menuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('active');
            });
            
            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);
            
            // Quick add modal
            quickAddBtn.addEventListener('click', () => {
                quickAddModal.classList.add('active');
            });
            
            closeQuickAddModal.addEventListener('click', () => {
                quickAddModal.classList.remove('active');
            });
            
            // Notification panel
            notificationBtn.addEventListener('click', () => {
                notificationPanel.classList.toggle('active');
            });
            
            // Close notification panel when clicking outside
            document.addEventListener('click', (e) => {
                if (!notificationBtn.contains(e.target) && !notificationPanel.contains(e.target)) {
                    notificationPanel.classList.remove('active');
                }
                
                if (!quickAddBtn.contains(e.target) && !quickAddModal.contains(e.target) && !e.target.closest('.modal')) {
                    quickAddModal.classList.remove('active');
                }
            });
            
            // Global search
            globalSearch.addEventListener('input', handleGlobalSearch);
            
            // Navigation
            document.querySelectorAll('.nav-item, .mobile-nav-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = item.getAttribute('data-page');
                    navigateToPage(page);
                    
                    // Update active state
                    document.querySelectorAll('.nav-item, .mobile-nav-item').forEach(nav => {
                        nav.classList.remove('active');
                    });
                    item.classList.add('active');
                    
                    // Close sidebar on mobile
                    if (window.innerWidth <= 768) {
                        sidebar.classList.remove('active');
                    }
                });
            });
            
            // Quick add actions
            document.getElementById('addTaskQuick').addEventListener('click', () => {
                quickAddModal.classList.remove('active');
                showAddTaskModal();
            });
            
            // Keyboard shortcuts (only when logged in)
            document.addEventListener('keydown', handleKeyboardShortcuts);
            
            // Auto-save form data
            setupAutoSave();
        }
        
        // Handle keyboard shortcuts
        function handleKeyboardShortcuts(e) {
            if (!keyboardShortcutsEnabled || !isLoggedIn) return;
            
            // Ctrl/Cmd + K for search
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                globalSearch.focus();
            }
            
            // N for new task (only when not in input field)
            if (e.key === 'n' && !e.ctrlKey && !e.metaKey && !isInputElement(e.target)) {
                e.preventDefault();
                showAddTaskModal();
            }
            
            // / for search (only when not in input field)
            if (e.key === '/' && !e.ctrlKey && !e.metaKey && !isInputElement(e.target)) {
                e.preventDefault();
                globalSearch.focus();
            }
            
            // Escape to close modals
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay').forEach(modal => {
                    modal.classList.remove('active');
                });
                notificationPanel.classList.remove('active');
            }
        }
        
        // Check if element is an input element
        function isInputElement(element) {
            return element.tagName === 'INPUT' || 
                   element.tagName === 'TEXTAREA' || 
                   element.tagName === 'SELECT' ||
                   element.isContentEditable;
        }
        
        // Initialize with sample data if empty
        function initializeData() {
            const days = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat'];
            const subjects = ['Matematika', 'Bahasa Indonesia', 'Bahasa Inggris', 'IPA', 'IPS', 'Sejarah'];
            
            // Add sample schedule if empty
            if (state.schedule.length === 0) {
                days.forEach(day => {
                    const daySchedule = [];
                    for (let i = 1; i <= 5; i++) {
                        daySchedule.push({
                            time: `${7 + i}:00`,
                            subject: subjects[Math.floor(Math.random() * subjects.length)],
                            room: `R${Math.floor(Math.random() * 10) + 1}`
                        });
                    }
                    state.schedule.push({
                        day,
                        classes: daySchedule
                    });
                });
                saveData('schedule');
            }
            
            // Add sample tasks if empty
            if (state.tasks.length === 0) {
                const today = new Date();
                for (let i = 1; i <= 5; i++) {
                    const taskDate = new Date(today);
                    taskDate.setDate(today.getDate() + i);
                    
                    state.tasks.push({
                        id: generateId(),
                        title: `Tugas ${subjects[i-1]}`,
                        subject: subjects[i-1],
                        deadline: taskDate.toISOString(),
                        priority: i === 1 ? 'high' : (i === 2 ? 'medium' : 'low'),
                        completed: false,
                        notes: '',
                        createdAt: new Date().toISOString()
                    });
                }
                saveData('tasks');
            }
            
            // Add sample habits if empty
            if (state.habits.length === 0) {
                const habitTitles = [
                    'Baca buku 30 menit',
                    'Olahraga pagi',
                    'Review pelajaran',
                    'Minum air 8 gelas',
                    'Tidur sebelum 22:00'
                ];
                
                habitTitles.forEach((title, index) => {
                    const history = {};
                    const today = new Date().toISOString().split('T')[0];
                    
                    // Mark some habits as completed today
                    if (index < 2) {
                        history[today] = true;
                    }
                    
                    state.habits.push({
                        id: generateId(),
                        title,
                        description: '',
                        streak: index * 3,
                        history,
                        createdAt: new Date().toISOString()
                    });
                });
                saveData('habits');
            }
            
            // Add sample notifications
            if (state.notifications.length === 0) {
                state.notifications = [
                    {
                        id: generateId(),
                        title: 'Tugas Matematika deadline besok',
                        message: 'Jangan lupa kerjakan tugas Matematika tentang aljabar',
                        type: 'warning',
                        time: new Date(Date.now() - 3600000).toISOString(),
                        read: false
                    },
                    {
                        id: generateId(),
                        title: 'Habit streak berhasil!',
                        message: 'Kamu telah menyelesaikan 7 hari berturut-turut membaca buku',
                        type: 'success',
                        time: new Date(Date.now() - 7200000).toISOString(),
                        read: false
                    },
                    {
                        id: generateId(),
                        title: 'Pelajaran berikutnya: Bahasa Indonesia',
                        message: 'Pelajaran Bahasa Indonesia dimulai 10 menit lagi di Ruang 5',
                        type: 'info',
                        time: new Date(Date.now() - 10800000).toISOString(),
                        read: true
                    }
                ];
                saveData('notifications');
            }
        }
        
        // Update dashboard with current data
        function updateDashboard() {
            // Update today's tasks count
            const today = new Date().toISOString().split('T')[0];
            const todayTasks = state.tasks.filter(task => {
                const taskDate = new Date(task.deadline).toISOString().split('T')[0];
                return taskDate === today && !task.completed;
            }).length;
            document.getElementById('todayTasks').textContent = todayTasks;
            
            // Update completed habits percentage
            const todayHabits = state.habits.filter(habit => {
                return habit.history[today] === true;
            }).length;
            const totalHabits = state.habits.length;
            const habitPercentage = totalHabits > 0 ? Math.round((todayHabits / totalHabits) * 100) : 0;
            document.getElementById('completedHabits').textContent = `${habitPercentage}%`;
            
            // Update next class
            const now = new Date();
            const currentHour = now.getHours();
            const currentDay = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'][now.getDay()];
            
            let nextClass = '-';
            const todaySchedule = state.schedule.find(s => s.day === currentDay);
            
            if (todaySchedule) {
                for (const cls of todaySchedule.classes) {
                    const classHour = parseInt(cls.time.split(':')[0]);
                    if (classHour > currentHour) {
                        nextClass = `${cls.subject} (${cls.time})`;
                        break;
                    }
                }
            }
            document.getElementById('nextClass').textContent = nextClass;
            
            // Update current balance
            const balance = state.transactions.reduce((total, transaction) => {
                return transaction.type === 'income' ? total + transaction.amount : total - transaction.amount;
            }, 0);
            document.getElementById('currentBalance').textContent = `Rp ${balance.toLocaleString('id-ID')}`;
            
            // Update today's schedule
            updateTodaySchedule(currentDay);
            
            // Update upcoming tasks
            updateUpcomingTasks();
            
            // Update today's habits
            updateTodayHabits();
            
            // Update XP progress
            updateXPProgress();
            
            // Update productivity chart
            updateProductivityChart();
        }
        
        // Update today's schedule display
        function updateTodaySchedule(currentDay) {
            const todayScheduleContainer = document.getElementById('todaySchedule');
            const todaySchedule = state.schedule.find(s => s.day === currentDay);
            
            if (todaySchedule && todaySchedule.classes.length > 0) {
                let scheduleHTML = `
                    <table class="schedule-table">
                        <thead>
                            <tr>
                                <th>Waktu</th>
                                <th>Mata Pelajaran</th>
                                <th>Ruangan</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                todaySchedule.classes.forEach(cls => {
                    scheduleHTML += `
                        <tr>
                            <td>${cls.time}</td>
                            <td>${cls.subject}</td>
                            <td>${cls.room}</td>
                        </tr>
                    `;
                });
                
                scheduleHTML += `
                        </tbody>
                    </table>
                `;
                
                todayScheduleContainer.innerHTML = scheduleHTML;
            } else {
                todayScheduleContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i data-lucide="calendar"></i>
                        </div>
                        <h3 class="empty-state-title">Tidak ada jadwal hari ini</h3>
                        <p class="empty-state-description">Tambahkan jadwal pelajaran untuk melihatnya di sini</p>
                        <button class="btn btn-primary" id="addScheduleBtn">Tambah Jadwal</button>
                    </div>
                `;
                
                // Add event listener to the button
                document.getElementById('addScheduleBtn')?.addEventListener('click', () => {
                    navigateToPage('schedule');
                });
            }
        }
        
        // Update upcoming tasks display
        function updateUpcomingTasks() {
            const upcomingTasksContainer = document.getElementById('upcomingTasks');
            const now = new Date();
            
            // Get upcoming tasks (not completed, deadline in the future)
            const upcomingTasks = state.tasks
                .filter(task => !task.completed && new Date(task.deadline) > now)
                .sort((a, b) => new Date(a.deadline) - new Date(b.deadline))
                .slice(0, 5); // Show only 5 tasks
            
            if (upcomingTasks.length > 0) {
                let tasksHTML = '';
                
                upcomingTasks.forEach(task => {
                    const deadline = new Date(task.deadline);
                    const timeDiff = deadline - now;
                    const daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
                    
                    let countdownClass = 'countdown-success';
                    let countdownText = `${daysDiff} hari lagi`;
                    
                    if (daysDiff === 1) {
                        countdownClass = 'countdown-warning';
                        countdownText = 'Besok';
                    } else if (daysDiff === 0) {
                        countdownClass = 'countdown-danger';
                        const hoursDiff = Math.ceil(timeDiff / (1000 * 60 * 60));
                        countdownText = `${hoursDiff} jam lagi`;
                    } else if (daysDiff < 0) {
                        countdownClass = 'countdown-danger';
                        countdownText = 'Terlambat!';
                    }
                    
                    tasksHTML += `
                        <div class="task-item" data-task-id="${task.id}">
                            <div class="task-checkbox ${task.completed ? 'checked' : ''}" data-task-id="${task.id}">
                                ${task.completed ? '<i data-lucide="check"></i>' : ''}
                            </div>
                            <div class="task-info">
                                <div class="task-title">${task.title}</div>
                                <div class="task-subtitle">${task.subject}</div>
                            </div>
                            <div class="task-priority priority-${task.priority}">
                                ${task.priority === 'high' ? 'Tinggi' : task.priority === 'medium' ? 'Sedang' : 'Rendah'}
                            </div>
                            <div class="task-deadline">
                                <span class="countdown ${countdownClass}">${countdownText}</span>
                            </div>
                        </div>
                    `;
                });
                
                upcomingTasksContainer.innerHTML = tasksHTML;
                
                // Add event listeners to task checkboxes
                document.querySelectorAll('.task-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('click', (e) => {
                        const taskId = e.currentTarget.getAttribute('data-task-id');
                        toggleTaskCompletion(taskId);
                    });
                });
            } else {
                upcomingTasksContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i data-lucide="check-square"></i>
                        </div>
                        <h3 class="empty-state-title">Tidak ada tugas mendatang</h3>
                        <p class="empty-state-description">Semua tugas sudah selesai atau belum ada tugas yang ditambahkan</p>
                        <button class="btn btn-primary" id="addTaskBtn">Tambah Tugas</button>
                    </div>
                `;
                
                // Add event listener to the button
                document.getElementById('addTaskBtn')?.addEventListener('click', () => {
                    showAddTaskModal();
                });
            }
        }
        
        // Update today's habits display
        function updateTodayHabits() {
            const todayHabitsContainer = document.getElementById('todayHabits');
            const today = new Date().toISOString().split('T')[0];
            
            if (state.habits.length > 0) {
                let habitsHTML = '';
                
                state.habits.forEach(habit => {
                    const isCompleted = habit.history[today] === true;
                    
                    habitsHTML += `
                        <div class="habit-item">
                            <div class="habit-name">${habit.title}</div>
                            <div class="habit-streak">
                                <i data-lucide="flame"></i>
                                <span class="streak-count">${habit.streak} hari</span>
                            </div>
                            <div class="habit-checkbox ${isCompleted ? 'checked' : ''}" data-habit-id="${habit.id}">
                                ${isCompleted ? '<i data-lucide="check"></i>' : ''}
                            </div>
                        </div>
                    `;
                });
                
                todayHabitsContainer.innerHTML = habitsHTML;
                
                // Add event listeners to habit checkboxes
                document.querySelectorAll('.habit-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('click', (e) => {
                        const habitId = e.currentTarget.getAttribute('data-habit-id');
                        toggleHabitCompletion(habitId);
                    });
                });
            } else {
                todayHabitsContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i data-lucide="target"></i>
                        </div>
                        <h3 class="empty-state-title">Belum ada habit</h3>
                        <p class="empty-state-description">Tambahkan habit untuk melacak kebiasaan baik Anda</p>
                        <button class="btn btn-primary" id="addHabitBtn">Tambah Habit</button>
                    </div>
                `;
                
                // Add event listener to the button
                document.getElementById('addHabitBtn')?.addEventListener('click', () => {
                    showAddHabitModal();
                });
            }
        }
        
        // Update XP progress
        function updateXPProgress() {
            const xpForCurrentLevel = (state.user.level - 1) * 100;
            const xpInCurrentLevel = state.user.xp - xpForCurrentLevel;
            const xpProgress = Math.min((xpInCurrentLevel / 100) * 100, 100);
            
            document.getElementById('currentXP').textContent = state.user.xp;
            document.getElementById('nextLevel').textContent = state.user.level + 1;
            document.getElementById('nextLevelXP').textContent = (state.user.level * 100) - state.user.xp;
            document.getElementById('xpProgress').style.width = `${xpProgress}%`;
        }
        
        // Update productivity chart
        function updateProductivityChart() {
            const ctx = document.getElementById('productivityChart').getContext('2d');
            
            // Generate sample data for the past 7 days
            const days = ['Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab', 'Min'];
            const completedTasks = [];
            const studyHours = [];
            
            for (let i = 0; i < 7; i++) {
                completedTasks.push(Math.floor(Math.random() * 5) + 1);
                studyHours.push(Math.floor(Math.random() * 4) + 1);
            }
            
            // Destroy existing chart if it exists
            if (window.productivityChart) {
                window.productivityChart.destroy();
            }
            
            // Create new chart
            window.productivityChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: days,
                    datasets: [
                        {
                            label: 'Tugas Selesai',
                            data: completedTasks,
                            backgroundColor: 'rgba(37, 99, 235, 0.7)',
                            borderColor: 'rgba(37, 99, 235, 1)',
                            borderWidth: 1,
                            borderRadius: 6
                        },
                        {
                            label: 'Jam Belajar',
                            data: studyHours,
                            backgroundColor: 'rgba(124, 58, 237, 0.7)',
                            borderColor: 'rgba(124, 58, 237, 1)',
                            borderWidth: 1,
                            borderRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary').trim()
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: getComputedStyle(document.documentElement).getPropertyValue('--border-color').trim()
                            },
                            ticks: {
                                color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary').trim()
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: getComputedStyle(document.documentElement).getPropertyValue('--border-color').trim()
                            },
                            ticks: {
                                color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary').trim()
                            }
                        }
                    }
                }
            });
        }
        
        // Update notifications
        function updateNotifications() {
            const notificationList = document.getElementById('notificationList');
            const unreadCount = state.notifications.filter(n => !n.read).length;
            const notificationBadge = document.querySelector('.notification-badge');
            
            // Update badge
            if (unreadCount > 0) {
                notificationBadge.style.display = 'block';
            } else {
                notificationBadge.style.display = 'none';
            }
            
            // Update notification list
            let notificationsHTML = '';
            
            state.notifications.forEach(notification => {
                const time = new Date(notification.time);
                const timeAgo = getTimeAgo(time);
                
                notificationsHTML += `
                    <div class="notification-item ${notification.read ? '' : 'unread'}" data-notification-id="${notification.id}">
                        <div class="notification-icon">
                            <i data-lucide="${notification.type === 'warning' ? 'alert-triangle' : notification.type === 'success' ? 'check-circle' : 'info'}"></i>
                        </div>
                        <div class="notification-content">
                            <div class="notification-title">${notification.title}</div>
                            <div class="notification-message">${notification.message}</div>
                            <div class="notification-time">${timeAgo}</div>
                        </div>
                    </div>
                `;
            });
            
            notificationList.innerHTML = notificationsHTML;
            
            // Add event listeners to notification items
            document.querySelectorAll('.notification-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    const notificationId = e.currentTarget.getAttribute('data-notification-id');
                    markNotificationAsRead(notificationId);
                });
            });
        }
        
        // Toggle task completion
        function toggleTaskCompletion(taskId) {
            const task = state.tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                saveData('tasks');
                
                // Add XP for completing task
                if (task.completed) {
                    addXP(10);
                    showToast('Tugas selesai! +10 XP', 'success');
                    
                    // Create notification
                    createNotification(
                        'Tugas selesai!',
                        `Kamu telah menyelesaikan tugas "${task.title}"`,
                        'success'
                    );
                }
                
                updateDashboard();
                updateNotifications();
            }
        }
        
        // Toggle habit completion
        function toggleHabitCompletion(habitId) {
            const habit = state.habits.find(h => h.id === habitId);
            const today = new Date().toISOString().split('T')[0];
            
            if (habit) {
                const wasCompleted = habit.history[today] === true;
                habit.history[today] = !wasCompleted;
                
                // Update streak
                if (!wasCompleted) {
                    // Check previous day
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    const yesterdayStr = yesterday.toISOString().split('T')[0];
                    
                    if (habit.history[yesterdayStr] === true) {
                        habit.streak += 1;
                    } else {
                        habit.streak = 1;
                    }
                    
                    // Add XP for completing habit
                    addXP(5);
                    showToast('Habit selesai! +5 XP', 'success');
                } else {
                    habit.streak = Math.max(0, habit.streak - 1);
                }
                
                saveData('habits');
                updateDashboard();
            }
        }
        
        // Show add task modal
        function showAddTaskModal() {
            const modal = document.getElementById('addTaskModal');
            const form = document.getElementById('taskForm');
            const cancelBtn = document.getElementById('cancelTask');
            const closeBtn = document.getElementById('closeTaskModal');
            
            // Set default deadline (tomorrow at 23:59)
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(23, 59, 0, 0);
            
            document.getElementById('taskDeadline').value = tomorrow.toISOString().slice(0, 16);
            
            // Show modal
            modal.classList.add('active');
            
            // Form submission
            form.onsubmit = (e) => {
                e.preventDefault();
                
                const task = {
                    id: generateId(),
                    title: document.getElementById('taskTitle').value,
                    subject: document.getElementById('taskSubject').value,
                    deadline: document.getElementById('taskDeadline').value,
                    priority: document.getElementById('taskPriority').value,
                    notes: document.getElementById('taskNotes').value,
                    completed: false,
                    createdAt: new Date().toISOString()
                };
                
                state.tasks.push(task);
                saveData('tasks');
                
                // Create notification
                createNotification(
                    'Tugas baru ditambahkan',
                    `"${task.title}" deadline ${formatDate(new Date(task.deadline))}`,
                    'info'
                );
                
                // Close modal
                modal.classList.remove('active');
                form.reset();
                
                // Show success message
                showToast('Tugas berhasil ditambahkan', 'success');
                
                // Update dashboard
                updateDashboard();
                updateNotifications();
            };
            
            // Cancel button
            cancelBtn.onclick = () => {
                modal.classList.remove('active');
                form.reset();
            };
            
            // Close button
            closeBtn.onclick = () => {
                modal.classList.remove('active');
                form.reset();
            };
        }
        
        // Show add habit modal (simplified version)
        function showAddHabitModal() {
            const habitTitle = prompt('Masukkan nama habit baru:');
            if (habitTitle && habitTitle.trim()) {
                const habit = {
                    id: generateId(),
                    title: habitTitle.trim(),
                    description: '',
                    streak: 0,
                    history: {},
                    createdAt: new Date().toISOString()
                };
                
                state.habits.push(habit);
                saveData('habits');
                
                showToast('Habit berhasil ditambahkan', 'success');
                updateDashboard();
            }
        }
        
        // Toggle theme
        function toggleTheme() {
            const isDarkMode = document.body.classList.contains('dark-mode');
            
            if (isDarkMode) {
                document.body.classList.remove('dark-mode');
                document.body.classList.add('light-mode');
                themeIcon.setAttribute('data-lucide', 'moon');
                state.user.darkMode = false;
            } else {
                document.body.classList.remove('light-mode');
                document.body.classList.add('dark-mode');
                themeIcon.setAttribute('data-lucide', 'sun');
                state.user.darkMode = true;
            }
            
            lucide.createIcons();
            localStorage.setItem('pelajarPintarDarkMode', state.user.darkMode);
            
            // Update chart if it exists
            if (window.productivityChart) {
                updateProductivityChart();
            }
        }
        
        // Handle global search
        function handleGlobalSearch() {
            const query = globalSearch.value.toLowerCase().trim();
            
            if (query.length >= 2) {
                // Search in tasks
                const taskResults = state.tasks.filter(task => 
                    task.title.toLowerCase().includes(query) || 
                    task.subject.toLowerCase().includes(query)
                );
                
                // Search in habits
                const habitResults = state.habits.filter(habit => 
                    habit.title.toLowerCase().includes(query)
                );
                
                // TODO: Implement search results display
                console.log('Search results:', { taskResults, habitResults });
                
                // For now, just show a toast with result count
                const totalResults = taskResults.length + habitResults.length;
                if (totalResults > 0) {
                    showToast(`Ditemukan ${totalResults} hasil untuk "${query}"`, 'info');
                }
            }
        }
        
        // Navigate to page
        function navigateToPage(page) {
            const dashboardPage = document.getElementById('dashboardPage');
            const otherPages = document.getElementById('otherPages');
            
            if (page === 'dashboard') {
                dashboardPage.style.display = 'block';
                otherPages.style.display = 'none';
                updateDashboard();
            } else {
                dashboardPage.style.display = 'none';
                otherPages.style.display = 'block';
                
                // Load page content
                let pageContent = '';
                let pageTitle = '';
                let pageSubtitle = '';
                
                switch (page) {
                    case 'schedule':
                        pageTitle = 'Jadwal Pelajaran';
                        pageSubtitle = 'Kelola jadwal pelajaran kamu';
                        pageContent = generateSchedulePage();
                        break;
                    case 'tasks':
                        pageTitle = 'Manajemen Tugas';
                        pageSubtitle = 'Kelola semua tugas dan deadline';
                        pageContent = generateTasksPage();
                        break;
                    case 'habits':
                        pageTitle = 'Habit Tracker';
                        pageSubtitle = 'Lacak kebiasaan baik kamu';
                        pageContent = generateHabitsPage();
                        break;
                    case 'finance':
                        pageTitle = 'Keuangan Pribadi';
                        pageSubtitle = 'Kelola pemasukan dan pengeluaran';
                        pageContent = generateFinancePage();
                        break;
                    case 'stats':
                        pageTitle = 'Statistik';
                        pageSubtitle = 'Lihat perkembangan produktivitas kamu';
                        pageContent = generateStatsPage();
                        break;
                    case 'planner':
                        pageTitle = 'Smart Planner';
                        pageSubtitle = 'Rekomendasi belajar berdasarkan deadline';
                        pageContent = generatePlannerPage();
                        break;
                    case 'settings':
                        pageTitle = 'Pengaturan';
                        pageSubtitle = 'Kelola preferensi dan data aplikasi';
                        pageContent = generateSettingsPage();
                        break;
                    default:
                        pageTitle = 'Halaman';
                        pageSubtitle = '';
                        pageContent = '<p>Halaman sedang dalam pengembangan</p>';
                }
                
                otherPages.innerHTML = `
                    <h1 class="page-title">
                        <i data-lucide="${getPageIcon(page)}"></i>
                        ${pageTitle}
                    </h1>
                    <p class="page-subtitle">${pageSubtitle}</p>
                    ${pageContent}
                `;
                
                // Re-initialize icons
                lucide.createIcons();
                
                // Set up page-specific event listeners
                setupPageEventListeners(page);
            }
        }
        
        // Get icon for page
        function getPageIcon(page) {
            const icons = {
                'schedule': 'calendar',
                'tasks': 'check-square',
                'habits': 'target',
                'finance': 'wallet',
                'stats': 'bar-chart-3',
                'planner': 'brain',
                'settings': 'settings'
            };
            
            return icons[page] || 'file';
        }
        
        // Generate schedule page
        function generateSchedulePage() {
            let scheduleHTML = `
                <div class="card widget-full mb-30">
                    <div class="card-header">
                        <h2 class="card-title">Jadwal Mingguan</h2>
                        <div class="card-actions">
                            <button class="card-action-btn" id="addClassBtn">
                                <i data-lucide="plus"></i>
                            </button>
                            <button class="card-action-btn" id="editScheduleBtn">
                                <i data-lucide="edit"></i>
                            </button>
                        </div>
                    </div>
                    <div class="filter-container mb-20">
                        <button class="filter-btn active" data-day="all">Semua Hari</button>
                        <button class="filter-btn" data-day="senin">Senin</button>
                        <button class="filter-btn" data-day="selasa">Selasa</button>
                        <button class="filter-btn" data-day="rabu">Rabu</button>
                        <button class="filter-btn" data-day="kamis">Kamis</button>
                        <button class="filter-btn" data-day="jumat">Jumat</button>
                    </div>
                    <div id="scheduleTableContainer">
            `;
            
            // Get current day
            const currentDay = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'][new Date().getDay()];
            
            // Create schedule table
            scheduleHTML += '<table class="schedule-table">';
            scheduleHTML += `
                <thead>
                    <tr>
                        <th>Hari</th>
                        <th>Waktu</th>
                        <th>Mata Pelajaran</th>
                        <th>Ruangan</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            state.schedule.forEach(daySchedule => {
                daySchedule.classes.forEach((cls, index) => {
                    const isToday = daySchedule.day === currentDay;
                    scheduleHTML += `
                        <tr class="${isToday ? 'today' : ''}">
                            ${index === 0 ? `<td rowspan="${daySchedule.classes.length}">${daySchedule.day}</td>` : ''}
                            <td>${cls.time}</td>
                            <td>${cls.subject}</td>
                            <td>${cls.room}</td>
                            ${index === 0 ? `<td rowspan="${daySchedule.classes.length}">
                                <button class="btn btn-secondary" data-day="${daySchedule.day.toLowerCase()}" data-action="edit-day">Edit</button>
                            </td>` : ''}
                        </tr>
                    `;
                });
            });
            
            scheduleHTML += `
                    </tbody>
                </table>
                </div>
            </div>
            
            <div class="card widget-full">
                <div class="card-header">
                    <h2 class="card-title">Ekspor/Impor Jadwal</h2>
                </div>
                <div class="flex gap-20">
                    <button class="btn btn-primary" id="exportScheduleBtn">
                        <i data-lucide="download" class="mr-2"></i>
                        Ekspor Jadwal
                    </button>
                    <button class="btn btn-secondary" id="importScheduleBtn">
                        <i data-lucide="upload" class="mr-2"></i>
                        Impor Jadwal
                    </button>
                </div>
            </div>
            `;
            
            return scheduleHTML;
        }
        
        // Generate tasks page
        function generateTasksPage() {
            const pendingTasks = state.tasks.filter(task => !task.completed).length;
            const completedTasks = state.tasks.filter(task => task.completed).length;
            
            return `
                <div class="stats-container mb-30">
                    <div class="stat-card">
                        <div class="stat-icon primary">
                            <i data-lucide="list"></i>
                        </div>
                        <div class="stat-value">${state.tasks.length}</div>
                        <div class="stat-label">Total Tugas</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon warning">
                            <i data-lucide="clock"></i>
                        </div>
                        <div class="stat-value">${pendingTasks}</div>
                        <div class="stat-label">Tugas Pending</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon success">
                            <i data-lucide="check-circle"></i>
                        </div>
                        <div class="stat-value">${completedTasks}</div>
                        <div class="stat-label">Tugas Selesai</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon danger">
                            <i data-lucide="alert-triangle"></i>
                        </div>
                        <div class="stat-value">${state.tasks.filter(task => {
                            const deadline = new Date(task.deadline);
                            const now = new Date();
                            const diffTime = deadline - now;
                            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                            return diffDays <= 1 && !task.completed;
                        }).length}</div>
                        <div class="stat-label">Deadline Dekat</div>
                    </div>
                </div>
                
                <div class="card widget-full mb-30">
                    <div class="card-header">
                        <h2 class="card-title">Semua Tugas</h2>
                        <div class="card-actions">
                            <button class="btn btn-primary" id="addNewTaskBtn">
                                <i data-lucide="plus" class="mr-2"></i>
                                Tambah Tugas
                            </button>
                        </div>
                    </div>
                    <div class="filter-container mb-20">
                        <button class="filter-btn active" data-filter="all">Semua</button>
                        <button class="filter-btn" data-filter="pending">Belum Selesai</button>
                        <button class="filter-btn" data-filter="completed">Selesai</button>
                        <button class="filter-btn" data-filter="high">Prioritas Tinggi</button>
                        <button class="filter-btn" data-filter="today">Hari Ini</button>
                    </div>
                    <div id="allTasksList">
                        ${generateTaskListHTML(state.tasks)}
                    </div>
                </div>
                
                <div class="card widget-full">
                    <div class="card-header">
                        <h2 class="card-title">Analisis Tugas</h2>
                    </div>
                    <div class="chart-container">
                        <canvas id="taskAnalysisChart"></canvas>
                    </div>
                </div>
            `;
        }
        
        // Generate task list HTML
        function generateTaskListHTML(tasks) {
            if (tasks.length === 0) {
                return `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i data-lucide="check-square"></i>
                        </div>
                        <h3 class="empty-state-title">Belum ada tugas</h3>
                        <p class="empty-state-description">Tambahkan tugas pertama Anda untuk memulai</p>
                        <button class="btn btn-primary" id="addFirstTaskBtn">Tambah Tugas</button>
                    </div>
                `;
            }
            
            let tasksHTML = '';
            
            tasks.forEach(task => {
                const deadline = new Date(task.deadline);
                const now = new Date();
                const timeDiff = deadline - now;
                const daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
                
                let countdownClass = 'countdown-success';
                let countdownText = `${daysDiff} hari lagi`;
                
                if (daysDiff === 1) {
                    countdownClass = 'countdown-warning';
                    countdownText = 'Besok';
                } else if (daysDiff === 0) {
                    countdownClass = 'countdown-danger';
                    const hoursDiff = Math.ceil(timeDiff / (1000 * 60 * 60));
                    countdownText = `${hoursDiff} jam lagi`;
                } else if (daysDiff < 0) {
                    countdownClass = 'countdown-danger';
                    countdownText = 'Terlambat!';
                }
                
                tasksHTML += `
                    <div class="task-item" data-task-id="${task.id}">
                        <div class="task-checkbox ${task.completed ? 'checked' : ''}" data-task-id="${task.id}">
                            ${task.completed ? '<i data-lucide="check"></i>' : ''}
                        </div>
                        <div class="task-info">
                            <div class="task-title">${task.title}</div>
                            <div class="task-subtitle">${task.subject} â€¢ ${formatDate(deadline)}</div>
                        </div>
                        <div class="task-priority priority-${task.priority}">
                            ${task.priority === 'high' ? 'Tinggi' : task.priority === 'medium' ? 'Sedang' : 'Rendah'}
                        </div>
                        <div class="task-deadline">
                            <span class="countdown ${countdownClass}">${countdownText}</span>
                        </div>
                        <div class="card-actions">
                            <button class="card-action-btn" data-task-id="${task.id}" data-action="edit-task">
                                <i data-lucide="edit"></i>
                            </button>
                            <button class="card-action-btn" data-task-id="${task.id}" data-action="delete-task">
                                <i data-lucide="trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            return tasksHTML;
        }
        
        // Generate habits page
        function generateHabitsPage() {
            const totalHabits = state.habits.length;
            const today = new Date().toISOString().split('T')[0];
            const completedToday = state.habits.filter(habit => habit.history[today] === true).length;
            const completionRate = totalHabits > 0 ? Math.round((completedToday / totalHabits) * 100) : 0;
            
            // Calculate best streak
            const bestStreak = state.habits.length > 0 ? 
                Math.max(...state.habits.map(habit => habit.streak)) : 0;
            
            return `
                <div class="stats-container mb-30">
                    <div class="stat-card">
                        <div class="stat-icon primary">
                            <i data-lucide="target"></i>
                        </div>
                        <div class="stat-value">${totalHabits}</div>
                        <div class="stat-label">Total Habit</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon success">
                            <i data-lucide="check-circle"></i>
                        </div>
                        <div class="stat-value">${completionRate}%</div>
                        <div class="stat-label">Selesai Hari Ini</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon warning">
                            <i data-lucide="flame"></i>
                        </div>
                        <div class="stat-value">${bestStreak}</div>
                        <div class="stat-label">Streak Terbaik</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon danger">
                            <i data-lucide="trending-up"></i>
                        </div>
                        <div class="stat-value">${state.habits.reduce((sum, habit) => sum + habit.streak, 0)}</div>
                        <div class="stat-label">Total Streak</div>
                    </div>
                </div>
                
                <div class="card widget-full">
                    <div class="card-header">
                        <h2 class="card-title">Semua Habit</h2>
                        <div class="card-actions">
                            <button class="btn btn-primary" id="addNewHabitBtn">
                                <i data-lucide="plus" class="mr-2"></i>
                                Tambah Habit
                            </button>
                        </div>
                    </div>
                    <div class="filter-container mb-20">
                        <button class="filter-btn active" data-filter="all">Semua</button>
                        <button class="filter-btn" data-filter="active">Aktif</button>
                        <button class="filter-btn" data-filter="streak">Streak Tinggi</button>
                    </div>
                    <div id="allHabitsList">
                        ${generateHabitListHTML(state.habits)}
                    </div>
                </div>
            `;
        }
        
        // Generate habit list HTML
        function generateHabitListHTML(habits) {
            if (habits.length === 0) {
                return `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i data-lucide="target"></i>
                        </div>
                        <h3 class="empty-state-title">Belum ada habit</h3>
                        <p class="empty-state-description">Tambahkan habit pertama Anda untuk melacak kebiasaan baik</p>
                        <button class="btn btn-primary" id="addFirstHabitBtn">Tambah Habit</button>
                    </div>
                `;
            }
            
            let habitsHTML = '';
            const today = new Date().toISOString().split('T')[0];
            
            habits.forEach(habit => {
                const isCompleted = habit.history[today] === true;
                
                habitsHTML += `
                    <div class="habit-item">
                        <div class="habit-name">${habit.title}</div>
                        <div class="habit-streak">
                            <i data-lucide="flame"></i>
                            <span class="streak-count">${habit.streak} hari</span>
                        </div>
                        <div class="habit-checkbox ${isCompleted ? 'checked' : ''}" data-habit-id="${habit.id}">
                            ${isCompleted ? '<i data-lucide="check"></i>' : ''}
                        </div>
                        <div class="card-actions">
                            <button class="card-action-btn" data-habit-id="${habit.id}" data-action="edit-habit">
                                <i data-lucide="edit"></i>
                            </button>
                            <button class="card-action-btn" data-habit-id="${habit.id}" data-action="delete-habit">
                                <i data-lucide="trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            return habitsHTML;
        }
        
        // Generate finance page
        function generateFinancePage() {
            const income = state.transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
                
            const expense = state.transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
                
            const balance = income - expense;
            
            return `
                <div class="stats-container mb-30">
                    <div class="stat-card">
                        <div class="stat-icon success">
                            <i data-lucide="arrow-down-circle"></i>
                        </div>
                        <div class="stat-value">Rp ${income.toLocaleString('id-ID')}</div>
                        <div class="stat-label">Pemasukan</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon danger">
                            <i data-lucide="arrow-up-circle"></i>
                        </div>
                        <div class="stat-value">Rp ${expense.toLocaleString('id-ID')}</div>
                        <div class="stat-label">Pengeluaran</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon primary">
                            <i data-lucide="wallet"></i>
                        </div>
                        <div class="stat-value">Rp ${balance.toLocaleString('id-ID')}</div>
                        <div class="stat-label">Saldo</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon warning">
                            <i data-lucide="trending-up"></i>
                        </div>
                        <div class="stat-value">${state.transactions.length}</div>
                        <div class="stat-label">Total Transaksi</div>
                    </div>
                </div>
                
                <div class="dashboard-grid mb-30">
                    <div class="card widget-large">
                        <div class="card-header">
                            <h2 class="card-title">Tambah Transaksi</h2>
                        </div>
                        <form id="transactionForm">
                            <div class="form-group">
                                <label class="form-label" for="transactionType">Jenis Transaksi</label>
                                <select class="form-select" id="transactionType" required>
                                    <option value="income">Pemasukan</option>
                                    <option value="expense">Pengeluaran</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="transactionAmount">Jumlah (Rp)</label>
                                <input type="number" class="form-input" id="transactionAmount" placeholder="100000" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="transactionCategory">Kategori</label>
                                <select class="form-select" id="transactionCategory" required>
                                    <option value="uang saku">Uang Saku</option>
                                    <option value="kerja sampingan">Kerja Sampingan</option>
                                    <option value="hadiah">Hadiah</option>
                                    <option value="makanan">Makanan</option>
                                    <option value="transportasi">Transportasi</option>
                                    <option value="hiburan">Hiburan</option>
                                    <option value="belajar">Belajar</option>
                                    <option value="lainnya">Lainnya</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="transactionDescription">Keterangan (opsional)</label>
                                <input type="text" class="form-input" id="transactionDescription" placeholder="Contoh: Jajan di kantin">
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-full">Tambah Transaksi</button>
                        </form>
                    </div>
                    
                    <div class="card widget-large">
                        <div class="card-header">
                            <h2 class="card-title">Riwayat Transaksi</h2>
                        </div>
                        <div id="transactionHistory">
                            ${generateTransactionHistoryHTML()}
                        </div>
                    </div>
                </div>
                
                <div class="card widget-full">
                    <div class="card-header">
                        <h2 class="card-title">Statistik Keuangan</h2>
                    </div>
                    <div class="chart-container">
                        <canvas id="financeChart"></canvas>
                    </div>
                </div>
            `;
        }
        
        // Generate transaction history HTML
        function generateTransactionHistoryHTML() {
            if (state.transactions.length === 0) {
                return `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i data-lucide="wallet"></i>
                        </div>
                        <h3 class="empty-state-title">Belum ada transaksi</h3>
                        <p class="empty-state-description">Tambahkan transaksi pertama Anda</p>
                    </div>
                `;
            }
            
            let transactionsHTML = '';
            
            // Show only last 5 transactions
            const recentTransactions = [...state.transactions]
                .sort((a, b) => new Date(b.date || b.createdAt) - new Date(a.date || a.createdAt))
                .slice(0, 5);
            
            recentTransactions.forEach(transaction => {
                const isIncome = transaction.type === 'income';
                
                transactionsHTML += `
                    <div class="task-item">
                        <div class="task-info">
                            <div class="task-title">${transaction.description || 'Tanpa keterangan'}</div>
                            <div class="task-subtitle">${transaction.category} â€¢ ${formatDate(new Date(transaction.date || transaction.createdAt))}</div>
                        </div>
                        <div class="task-priority ${isIncome ? 'priority-low' : 'priority-high'}">
                            ${isIncome ? '+' : '-'} Rp ${transaction.amount.toLocaleString('id-ID')}
                        </div>
                    </div>
                `;
            });
            
            return transactionsHTML;
        }
        
        // Generate stats page
        function generateStatsPage() {
            return `
                <div class="dashboard-grid mb-30">
                    <div class="card widget-large">
                        <div class="card-header">
                            <h2 class="card-title">Statistik Tugas</h2>
                        </div>
                        <div class="chart-container">
                            <canvas id="taskStatsChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card widget-large">
                        <div class="card-header">
                            <h2 class="card-title">Statistik Habit</h2>
                        </div>
                        <div class="chart-container">
                            <canvas id="habitStatsChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="card widget-full">
                    <div class="card-header">
                        <h2 class="card-title">Ringkasan Produktivitas</h2>
                    </div>
                    <div class="stats-container">
                        <div class="stat-card">
                            <div class="stat-icon primary">
                                <i data-lucide="trending-up"></i>
                            </div>
                            <div class="stat-value">${state.user.xp}</div>
                            <div class="stat-label">Total XP</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon success">
                                <i data-lucide="check-circle"></i>
                            </div>
                            <div class="stat-value">${state.tasks.filter(t => t.completed).length}</div>
                            <div class="stat-label">Tugas Selesai</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon warning">
                                <i data-lucide="flame"></i>
                            </div>
                            <div class="stat-value">${state.habits.reduce((sum, habit) => sum + habit.streak, 0)}</div>
                            <div class="stat-label">Total Streak</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon danger">
                                <i data-lucide="target"></i>
                            </div>
                            <div class="stat-value">${state.user.level}</div>
                            <div class="stat-label">Level Saat Ini</div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Generate planner page
        function generatePlannerPage() {
            // Get tasks due in the next 7 days
            const now = new Date();
            const nextWeek = new Date();
            nextWeek.setDate(now.getDate() + 7);
            
            const upcomingTasks = state.tasks
                .filter(task => !task.completed && new Date(task.deadline) <= nextWeek)
                .sort((a, b) => new Date(a.deadline) - new Date(b.deadline));
            
            let recommendationsHTML = '';
            
            if (upcomingTasks.length > 0) {
                recommendationsHTML = `
                    <div class="card widget-full mb-30">
                        <div class="card-header">
                            <h2 class="card-title">Rekomendasi Belajar Hari Ini</h2>
                        </div>
                        <div class="task-list">
                `;
                
                // Show top 3 priority tasks for today
                const todayTasks = upcomingTasks
                    .filter(task => {
                        const taskDate = new Date(task.deadline).toISOString().split('T')[0];
                        const today = now.toISOString().split('T')[0];
                        return taskDate === today;
                    })
                    .slice(0, 3);
                
                if (todayTasks.length > 0) {
                    todayTasks.forEach(task => {
                        recommendationsHTML += `
                            <div class="task-item">
                                <div class="task-info">
                                    <div class="task-title">Fokus: ${task.title}</div>
                                    <div class="task-subtitle">${task.subject} â€¢ Deadline: ${formatDate(new Date(task.deadline))}</div>
                                </div>
                                <div class="task-priority priority-${task.priority}">
                                    ${task.priority === 'high' ? 'Prioritas Tinggi' : task.priority === 'medium' ? 'Prioritas Sedang' : 'Prioritas Rendah'}
                                </div>
                            </div>
                        `;
                    });
                } else {
                    // If no tasks due today, recommend the closest deadline
                    const closestTask = upcomingTasks[0];
                    recommendationsHTML += `
                        <div class="task-item">
                            <div class="task-info">
                                <div class="task-title">Saran: Mulai kerjakan "${closestTask.title}"</div>
                                <div class="task-subtitle">${closestTask.subject} â€¢ Deadline: ${formatDate(new Date(closestTask.deadline))}</div>
                            </div>
                            <div class="task-priority priority-${closestTask.priority}">
                                Deadline terdekat
                            </div>
                        </div>
                    `;
                }
                
                recommendationsHTML += `
                        </div>
                    </div>
                `;
            }
            
            return `
                ${recommendationsHTML}
                
                <div class="dashboard-grid">
                    <div class="card widget-large">
                        <div class="card-header">
                            <h2 class="card-title">Analisis Deadline</h2>
                        </div>
                        <div id="deadlineAnalysis">
                            ${generateDeadlineAnalysisHTML()}
                        </div>
                    </div>
                    
                    <div class="card widget-large">
                        <div class="card-header">
                            <h2 class="card-title">Distribusi Waktu</h2>
                        </div>
                        <div class="chart-container">
                            <canvas id="timeDistributionChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="card widget-full mt-30">
                    <div class="card-header">
                        <h2 class="card-title">Tips Produktivitas</h2>
                    </div>
                    <div class="task-list">
                        <div class="task-item">
                            <div class="task-info">
                                <div class="task-title">Pomodoro Technique</div>
                                <div class="task-subtitle">Belajar 25 menit, istirahat 5 menit. Ulangi 4 kali lalu istirahat panjang 15-30 menit.</div>
                            </div>
                        </div>
                        <div class="task-item">
                            <div class="task-info">
                                <div class="task-title">Prioritas Eisenhower Matrix</div>
                                <div class="task-subtitle">Kategorikan tugas menjadi: penting & mendesak, penting tidak mendesak, tidak penting mendesak, tidak penting tidak mendesak.</div>
                            </div>
                        </div>
                        <div class="task-item">
                            <div class="task-info">
                                <div class="task-title">Time Blocking</div>
                                <div class="task-subtitle">Jadwalkan blok waktu khusus untuk setiap tugas di kalender Anda.</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Generate deadline analysis HTML
        function generateDeadlineAnalysisHTML() {
            const now = new Date();
            const tasksByPriority = {
                high: 0,
                medium: 0,
                low: 0
            };
            
            const overdueTasks = state.tasks.filter(task => {
                if (task.completed) return false;
                
                const deadline = new Date(task.deadline);
                tasksByPriority[task.priority]++;
                
                return deadline < now;
            }).length;
            
            const dueThisWeek = state.tasks.filter(task => {
                if (task.completed) return false;
                
                const deadline = new Date(task.deadline);
                const nextWeek = new Date();
                nextWeek.setDate(now.getDate() + 7);
                
                return deadline >= now && deadline <= nextWeek;
            }).length;
            
            return `
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-icon danger">
                            <i data-lucide="alert-triangle"></i>
                        </div>
                        <div class="stat-value">${overdueTasks}</div>
                        <div class="stat-label">Tugas Terlambat</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon warning">
                            <i data-lucide="clock"></i>
                        </div>
                        <div class="stat-value">${dueThisWeek}</div>
                        <div class="stat-label">Deadline Minggu Ini</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon primary">
                            <i data-lucide="bar-chart"></i>
                        </div>
                        <div class="stat-value">${tasksByPriority.high}</div>
                        <div class="stat-label">Prioritas Tinggi</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon success">
                            <i data-lucide="check-circle"></i>
                        </div>
                        <div class="stat-value">${state.tasks.filter(t => t.completed).length}</div>
                        <div class="stat-label">Tuntas</div>
                    </div>
                </div>
            `;
        }
        
        // Generate settings page
        function generateSettingsPage() {
            return `
                <div class="dashboard-grid">
                    <div class="card widget-large">
                        <div class="card-header">
                            <h2 class="card-title">Pengaturan Tampilan</h2>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Mode Tampilan</label>
                            <div class="flex gap-20">
                                <button class="btn ${state.user.darkMode ? 'btn-secondary' : 'btn-primary'}" id="lightModeBtn">
                                    <i data-lucide="sun" class="mr-2"></i>
                                    Terang
                                </button>
                                <button class="btn ${state.user.darkMode ? 'btn-primary' : 'btn-secondary'}" id="darkModeBtn">
                                    <i data-lucide="moon" class="mr-2"></i>
                                    Gelap
                                </button>
                            </div>
                        </div>
                        
                        <div class="form-group mt-20">
                            <label class="form-label">Nama Tampilan</label>
                            <input type="text" class="form-input" id="displayNameInput" value="${state.user.name}">
                            <button class="btn btn-secondary mt-10" id="updateNameBtn">Perbarui Nama</button>
                        </div>
                    </div>
                    
                    <div class="card widget-large">
                        <div class="card-header">
                            <h2 class="card-title">Manajemen Data</h2>
                        </div>
                        <div class="flex flex-col gap-20">
                            <button class="btn btn-primary" id="exportDataBtn">
                                <i data-lucide="download" class="mr-2"></i>
                                Ekspor Semua Data
                            </button>
                            <button class="btn btn-secondary" id="importDataBtn">
                                <i data-lucide="upload" class="mr-2"></i>
                                Impor Data
                            </button>
                            <button class="btn btn-secondary" id="backupDataBtn">
                                <i data-lucide="save" class="mr-2"></i>
                                Buat Backup
                            </button>
                            <button class="btn btn-danger" id="resetDataBtn">
                                <i data-lucide="trash-2" class="mr-2"></i>
                                Reset Semua Data
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="card widget-full mt-30">
                    <div class="card-header">
                        <h2 class="card-title">Keyboard Shortcuts</h2>
                    </div>
                    <div class="task-list">
                        <div class="task-item">
                            <div class="task-info">
                                <div class="task-title">Ctrl/Cmd + K</div>
                                <div class="task-subtitle">Fokus ke pencarian global</div>
                            </div>
                        </div>
                        <div class="task-item">
                            <div class="task-info">
                                <div class="task-title">N</div>
                                <div class="task-subtitle">Tambah tugas baru</div>
                            </div>
                        </div>
                        <div class="task-item">
                            <div class="task-info">
                                <div class="task-title">/</div>
                                <div class="task-subtitle">Fokus ke pencarian</div>
                            </div>
                        </div>
                        <div class="task-item">
                            <div class="task-info">
                                <div class="task-title">Esc</div>
                                <div class="task-subtitle">Tutup modal atau panel</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card widget-full mt-30">
                    <div class="card-header">
                        <h2 class="card-title">Tentang Aplikasi</h2>
                    </div>
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i data-lucide="graduation-cap"></i>
                        </div>
                        <h3 class="empty-state-title">PELAJAR PINTAR</h3>
                        <p class="empty-state-description">Smart Student Life OS v1.0.0</p>
                        <p class="empty-state-description">Aplikasi dashboard kehidupan pelajar yang menggabungkan manajemen tugas, habit tracker, keuangan, dan perencanaan belajar.</p>
                    </div>
                </div>
            `;
        }
        
        // Set up page event listeners
        function setupPageEventListeners(page) {
            switch (page) {
                case 'tasks':
                    setupTasksPageListeners();
                    break;
                case 'habits':
                    setupHabitsPageListeners();
                    break;
                case 'finance':
                    setupFinancePageListeners();
                    break;
                case 'settings':
                    setupSettingsPageListeners();
                    break;
                case 'stats':
                    setTimeout(() => {
                        initializeStatsPageCharts();
                    }, 100);
                    break;
                case 'planner':
                    setTimeout(() => {
                        initializePlannerPageCharts();
                    }, 100);
                    break;
            }
        }
        
        // Set up tasks page listeners
        function setupTasksPageListeners() {
            // Add new task button
            document.getElementById('addNewTaskBtn')?.addEventListener('click', showAddTaskModal);
            document.getElementById('addFirstTaskBtn')?.addEventListener('click', showAddTaskModal);
            
            // Filter buttons
            document.querySelectorAll('#tasksPage .filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Update active state
                    document.querySelectorAll('#tasksPage .filter-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Filter tasks
                    const filter = this.getAttribute('data-filter');
                    let filteredTasks = [...state.tasks];
                    
                    switch (filter) {
                        case 'pending':
                            filteredTasks = filteredTasks.filter(task => !task.completed);
                            break;
                        case 'completed':
                            filteredTasks = filteredTasks.filter(task => task.completed);
                            break;
                        case 'high':
                            filteredTasks = filteredTasks.filter(task => task.priority === 'high');
                            break;
                        case 'today':
                            const today = new Date().toISOString().split('T')[0];
                            filteredTasks = filteredTasks.filter(task => {
                                const taskDate = new Date(task.deadline).toISOString().split('T')[0];
                                return taskDate === today;
                            });
                            break;
                        // 'all' shows all tasks
                    }
                    
                    // Update task list
                    document.getElementById('allTasksList').innerHTML = generateTaskListHTML(filteredTasks);
                    
                    // Re-attach event listeners
                    document.querySelectorAll('.task-checkbox').forEach(checkbox => {
                        checkbox.addEventListener('click', (e) => {
                            const taskId = e.currentTarget.getAttribute('data-task-id');
                            toggleTaskCompletion(taskId);
                        });
                    });
                    
                    // Re-attach edit/delete buttons
                    document.querySelectorAll('[data-action="edit-task"]').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const taskId = e.currentTarget.getAttribute('data-task-id');
                            // TODO: Implement edit task
                            showToast('Fitur edit tugas akan segera tersedia', 'info');
                        });
                    });
                    
                    document.querySelectorAll('[data-action="delete-task"]').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const taskId = e.currentTarget.getAttribute('data-task-id');
                            if (confirm('Hapus tugas ini?')) {
                                state.tasks = state.tasks.filter(task => task.id !== taskId);
                                saveData('tasks');
                                updateDashboard();
                                navigateToPage('tasks'); // Refresh page
                                showToast('Tugas berhasil dihapus', 'success');
                            }
                        });
                    });
                });
            });
            
            // Initialize task analysis chart
            setTimeout(() => {
                initializeTaskAnalysisChart();
            }, 100);
        }
        
        // Initialize task analysis chart
        function initializeTaskAnalysisChart() {
            const ctx = document.getElementById('taskAnalysisChart')?.getContext('2d');
            if (!ctx) return;
            
            const completedBySubject = {};
            const pendingBySubject = {};
            
            state.tasks.forEach(task => {
                if (task.completed) {
                    completedBySubject[task.subject] = (completedBySubject[task.subject] || 0) + 1;
                } else {
                    pendingBySubject[task.subject] = (pendingBySubject[task.subject] || 0) + 1;
                }
            });
            
            const subjects = [...new Set(state.tasks.map(task => task.subject))];
            const completedData = subjects.map(subject => completedBySubject[subject] || 0);
            const pendingData = subjects.map(subject => pendingBySubject[subject] || 0);
            
            if (window.taskAnalysisChart) {
                window.taskAnalysisChart.destroy();
            }
            
            window.taskAnalysisChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: subjects,
                    datasets: [
                        {
                            label: 'Selesai',
                            data: completedData,
                            backgroundColor: 'rgba(16, 185, 129, 0.7)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Belum Selesai',
                            data: pendingData,
                            backgroundColor: 'rgba(239, 68, 68, 0.7)',
                            borderColor: 'rgba(239, 68, 68, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary').trim()
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: getComputedStyle(document.documentElement).getPropertyValue('--border-color').trim()
                            },
                            ticks: {
                                color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary').trim()
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: getComputedStyle(document.documentElement).getPropertyValue('--border-color').trim()
                            },
                            ticks: {
                                color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary').trim()
                            }
                        }
                    }
                }
            });
        }
        
        // Set up habits page listeners
        function setupHabitsPageListeners() {
            // Add new habit button
            document.getElementById('addNewHabitBtn')?.addEventListener('click', showAddHabitModal);
            document.getElementById('addFirstHabitBtn')?.addEventListener('click', showAddHabitModal);
            
            // Filter buttons
            document.querySelectorAll('#habitsPage .filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Update active state
                    document.querySelectorAll('#habitsPage .filter-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Filter habits
                    const filter = this.getAttribute('data-filter');
                    let filteredHabits = [...state.habits];
                    
                    switch (filter) {
                        case 'active':
                            // Show habits with recent activity
                            const today = new Date().toISOString().split('T')[0];
                            const yesterday = new Date();
                            yesterday.setDate(yesterday.getDate() - 1);
                            const yesterdayStr = yesterday.toISOString().split('T')[0];
                            
                            filteredHabits = filteredHabits.filter(habit => {
                                return habit.history[today] === true || habit.history[yesterdayStr] === true || habit.streak > 0;
                            });
                            break;
                        case 'streak':
                            filteredHabits = filteredHabits.sort((a, b) => b.streak - a.streak);
                            break;
                        // 'all' shows all habits
                    }
                    
                    // Update habit list
                    document.getElementById('allHabitsList').innerHTML = generateHabitListHTML(filteredHabits);
                    
                    // Re-attach event listeners
                    document.querySelectorAll('.habit-checkbox').forEach(checkbox => {
                        checkbox.addEventListener('click', (e) => {
                            const habitId = e.currentTarget.getAttribute('data-habit-id');
                            toggleHabitCompletion(habitId);
                        });
                    });
                    
                    // Re-attach edit/delete buttons
                    document.querySelectorAll('[data-action="edit-habit"]').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const habitId = e.currentTarget.getAttribute('data-habit-id');
                            // TODO: Implement edit habit
                            showToast('Fitur edit habit akan segera tersedia', 'info');
                        });
                    });
                    
                    document.querySelectorAll('[data-action="delete-habit"]').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const habitId = e.currentTarget.getAttribute('data-habit-id');
                            if (confirm('Hapus habit ini?')) {
                                state.habits = state.habits.filter(habit => habit.id !== habitId);
                                saveData('habits');
                                updateDashboard();
                                navigateToPage('habits'); // Refresh page
                                showToast('Habit berhasil dihapus', 'success');
                            }
                        });
                    });
                });
            });
            
            // Initialize habit stats chart
            setTimeout(() => {
                initializeHabitStatsChart();
            }, 100);
        }
        
        // Initialize habit stats chart
        function initializeHabitStatsChart() {
            const ctx = document.getElementById('habitStatsChart')?.getContext('2d');
            if (!ctx) return;
            
            // Calculate completion rates for last 7 days
            const days = [];
            const completionRates = [];
            const today = new Date();
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const dayName = ['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'][date.getDay()];
                
                days.push(dayName);
                
                let completed = 0;
                state.habits.forEach(habit => {
                    if (habit.history[dateStr] === true) {
                        completed++;
                    }
                });
                
                const rate = state.habits.length > 0 ? Math.round((completed / state.habits.length) * 100) : 0;
                completionRates.push(rate);
            }
            
            if (window.habitStatsChart) {
                window.habitStatsChart.destroy();
            }
            
            window.habitStatsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'Persentase Penyelesaian Habit',
                        data: completionRates,
                        borderColor: 'rgba(124, 58, 237, 1)',
                        backgroundColor: 'rgba(124, 58, 237, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary').trim()
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: getComputedStyle(document.documentElement).getPropertyValue('--border-color').trim()
                            },
                            ticks: {
                                color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary').trim()
                            }
                        },
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: getComputedStyle(document.documentElement).getPropertyValue('--border-color').trim()
                            },
                            ticks: {
                                color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary').trim()
                            }
                        }
                    }
                }
            });
        }
        
        // Set up finance page listeners
        function setupFinancePageListeners() {
            // Transaction form
            document.getElementById('transactionForm')?.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const transaction = {
                    id: generateId(),
                    type: document.getElementById('transactionType').value,
                    amount: parseInt(document.getElementById('transactionAmount').value),
                    category: document.getElementById('transactionCategory').value,
                    description: document.getElementById('transactionDescription').value,
                    date: new Date().toISOString()
                };
                
                state.transactions.push(transaction);
                saveData('transactions');
                
                // Clear form
                document.getElementById('transactionForm').reset();
                
                // Update page
                navigateToPage('finance');
                showToast('Transaksi berhasil ditambahkan', 'success');
                
                // Update dashboard
                updateDashboard();
            });
            
            // Initialize finance chart
            setTimeout(() => {
                initializeFinanceChart();
            }, 100);
        }
        
        // Initialize finance chart
        function initializeFinanceChart() {
            const ctx = document.getElementById('financeChart')?.getContext('2d');
            if (!ctx) return;
            
            // Calculate expenses by category
            const expensesByCategory = {};
            state.transactions
                .filter(t => t.type === 'expense')
                .forEach(transaction => {
                    expensesByCategory[transaction.category] = (expensesByCategory[transaction.category] || 0) + transaction.amount;
                });
            
            const categories = Object.keys(expensesByCategory);
            const amounts = Object.values(expensesByCategory);
            
            // Generate colors
            const colors = [
                'rgba(239, 68, 68, 0.7)',
                'rgba(245, 158, 11, 0.7)',
                'rgba(59, 130, 246, 0.7)',
                'rgba(16, 185, 129, 0.7)',
                'rgba(139, 92, 246, 0.7)',
                'rgba(236, 72, 153, 0.7)',
                'rgba(6, 182, 212, 0.7)'
            ];
            
            if (window.financeChart) {
                window.financeChart.destroy();
            }
            
            window.financeChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: categories,
                    datasets: [{
                        data: amounts,
                        backgroundColor: colors.slice(0, categories.length),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary').trim()
                            }
                        }
                    }
                }
            });
        }
        
        // Set up settings page listeners
        function setupSettingsPageListeners() {
            // Theme buttons
            document.getElementById('lightModeBtn')?.addEventListener('click', () => {
                if (state.user.darkMode) {
                    toggleTheme();
                }
            });
            
            document.getElementById('darkModeBtn')?.addEventListener('click', () => {
                if (!state.user.darkMode) {
                    toggleTheme();
                }
            });
            
            // Update name
            document.getElementById('updateNameBtn')?.addEventListener('click', () => {
                const newName = document.getElementById('displayNameInput').value.trim();
                if (newName && newName !== state.user.name) {
                    state.user.name = newName;
                    localStorage.setItem('pelajarPintarUserName', newName);
                    setupUser();
                    showToast('Nama berhasil diperbarui', 'success');
                }
            });
            
            // Export data
            document.getElementById('exportDataBtn')?.addEventListener('click', exportAllData);
            
            // Import data
            document.getElementById('importDataBtn')?.addEventListener('click', () => {
                showToast('Fitur import data akan segera tersedia', 'info');
            });
            
            // Backup data
            document.getElementById('backupDataBtn')?.addEventListener('click', () => {
                exportAllData();
                showToast('Backup data berhasil dibuat', 'success');
            });
            
            // Reset data
            document.getElementById('resetDataBtn')?.addEventListener('click', () => {
                if (confirm('Apakah Anda yakin ingin mereset semua data? Tindakan ini tidak dapat dibatalkan.')) {
                    resetAllData();
                }
            });
        }
        
        // Initialize stats page charts
        function initializeStatsPageCharts() {
            // Task stats chart
            const taskStatsCtx = document.getElementById('taskStatsChart')?.getContext('2d');
            if (taskStatsCtx) {
                const completedByMonth = [4, 7, 9, 12, 8, 10]; // Sample data
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun'];
                
                if (window.taskStatsChart) {
                    window.taskStatsChart.destroy();
                }
                
                window.taskStatsChart = new Chart(taskStatsCtx, {
                    type: 'bar',
                    data: {
                        labels: months,
                        datasets: [{
                            label: 'Tugas Selesai',
                            data: completedByMonth,
                            backgroundColor: 'rgba(37, 99, 235, 0.7)',
                            borderColor: 'rgba(37, 99, 235, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                labels: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary').trim()
                            }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--border-color').trim()
                                },
                                ticks: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary').trim()
                                }
                            },
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--border-color').trim()
                                },
                                ticks: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary').trim()
                                }
                            }
                        }
                    }
                });
            }
            
            // Initialize time distribution chart for planner page
            initializePlannerPageCharts();
        }
        
        // Initialize planner page charts
        function initializePlannerPageCharts() {
            const timeDistributionCtx = document.getElementById('timeDistributionChart')?.getContext('2d');
            if (timeDistributionCtx) {
                const timeData = [2, 3, 1, 4, 2, 1, 3]; // Sample data for 7 days
                const days = ['Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab', 'Min'];
                
                if (window.timeDistributionChart) {
                    window.timeDistributionChart.destroy();
                }
                
                window.timeDistributionChart = new Chart(timeDistributionCtx, {
                    type: 'line',
                    data: {
                        labels: days,
                        datasets: [{
                            label: 'Jam Belajar',
                            data: timeData,
                            borderColor: 'rgba(16, 185, 129, 1)',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                labels: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary').trim()
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--border-color').trim()
                                },
                                ticks: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary').trim()
                                }
                            },
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--border-color').trim()
                                },
                                ticks: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary').trim()
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Set up auto-save for forms
        function setupAutoSave() {
            // Auto-save for task form
            const taskForm = document.getElementById('taskForm');
            if (taskForm) {
                const formFields = taskForm.querySelectorAll('input, select, textarea');
                const formKey = 'taskFormDraft';
                
                // Load saved form data
                const savedData = localStorage.getItem(formKey);
                if (savedData) {
                    const data = JSON.parse(savedData);
                    formFields.forEach(field => {
                        if (data[field.id]) {
                            field.value = data[field.id];
                        }
                    });
                }
                
                // Save form data on change
                formFields.forEach(field => {
                    field.addEventListener('input', () => {
                        const formData = {};
                        formFields.forEach(f => {
                            formData[f.id] = f.value;
                        });
                        localStorage.setItem(formKey, JSON.stringify(formData));
                    });
                });
                
                // Clear saved data on form submit
                taskForm.addEventListener('submit', () => {
                    localStorage.removeItem(formKey);
                });
                
                // Clear saved data on cancel
                document.getElementById('cancelTask')?.addEventListener('click', () => {
                    localStorage.removeItem(formKey);
                });
            }
        }
        
        // Export all data
        function exportAllData() {
            const data = {
                user: state.user,
                tasks: state.tasks,
                habits: state.habits,
                schedule: state.schedule,
                transactions: state.transactions,
                notifications: state.notifications,
                exportedAt: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `pelajar-pintar-backup-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('Data berhasil diekspor', 'success');
        }
        
        // Reset all data
        function resetAllData() {
            // Clear all data from state
            state.tasks = [];
            state.habits = [];
            state.schedule = [];
            state.transactions = [];
            state.notifications = [];
            
            // Reset user XP and level
            state.user.xp = 0;
            state.user.level = 1;
            
            // Save empty data
            saveData('tasks');
            saveData('habits');
            saveData('schedule');
            saveData('transactions');
            saveData('notifications');
            localStorage.setItem('pelajarPintarUserXP', '0');
            localStorage.setItem('pelajarPintarUserLevel', '1');
            
            // Update UI
            updateDashboard();
            updateNotifications();
            
            // Navigate to dashboard
            navigateToPage('dashboard');
            
            showToast('Semua data berhasil direset', 'success');
        }
        
        // Create notification
        function createNotification(title, message, type) {
            const notification = {
                id: generateId(),
                title,
                message,
                type,
                time: new Date().toISOString(),
                read: false
            };
            
            state.notifications.unshift(notification);
            saveData('notifications');
            updateNotifications();
        }
        
        // Mark notification as read
        function markNotificationAsRead(notificationId) {
            const notification = state.notifications.find(n => n.id === notificationId);
            if (notification && !notification.read) {
                notification.read = true;
                saveData('notifications');
                updateNotifications();
            }
        }
        
        // Add XP to user
        function addXP(amount) {
            state.user.xp += amount;
            
            // Check for level up
            const xpForNextLevel = state.user.level * 100;
            if (state.user.xp >= xpForNextLevel) {
                state.user.level += 1;
                localStorage.setItem('pelajarPintarUserLevel', state.user.level.toString());
                showToast(`Selamat! Anda naik ke level ${state.user.level}`, 'success');
                
                // Create notification for level up
                createNotification(
                    'Level Up!',
                    `Selamat! Anda telah mencapai level ${state.user.level}`,
                    'success'
                );
            }
            
            localStorage.setItem('pelajarPintarUserXP', state.user.xp.toString());
            updateXPProgress();
        }
        
        // Save data to localStorage
        function saveData(type) {
            switch (type) {
                case 'tasks':
                    localStorage.setItem('pelajarPintarTasks', JSON.stringify(state.tasks));
                    break;
                case 'habits':
                    localStorage.setItem('pelajarPintarHabits', JSON.stringify(state.habits));
                    break;
                case 'schedule':
                    localStorage.setItem('pelajarPintarSchedule', JSON.stringify(state.schedule));
                    break;
                case 'transactions':
                    localStorage.setItem('pelajarPintarTransactions', JSON.stringify(state.transactions));
                    break;
                case 'notifications':
                    localStorage.setItem('pelajarPintarNotifications', JSON.stringify(state.notifications));
                    break;
            }
        }
        
        // Show toast notification
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = `toast-${Date.now()}`;
            
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.id = toastId;
            
            // Set icon based on type
            let icon = 'info';
            switch (type) {
                case 'success': icon = 'check-circle'; break;
                case 'warning': icon = 'alert-triangle'; break;
                case 'error': icon = 'x-circle'; break;
                case 'info': icon = 'info'; break;
            }
            
            toast.innerHTML = `
                <i data-lucide="${icon}"></i>
                <div>${message}</div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Initialize icon
            lucide.createIcons();
            
            // Show toast
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (document.getElementById(toastId)) {
                        toastContainer.removeChild(toast);
                    }
                }, 300);
            }, 5000);
            
            // Click to dismiss
            toast.addEventListener('click', () => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (document.getElementById(toastId)) {
                        toastContainer.removeChild(toast);
                    }
                }, 300);
            });
        }
        
        // Utility functions
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substring(2);
        }
        
        function formatDate(date) {
            return date.toLocaleDateString('id-ID', {
                day: 'numeric',
                month: 'short',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / (1000 * 60));
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            
            if (diffMins < 1) {
                return 'Baru saja';
            } else if (diffMins < 60) {
                return `${diffMins} menit yang lalu`;
            } else if (diffHours < 24) {
                return `${diffHours} jam yang lalu`;
            } else if (diffDays === 1) {
                return 'Kemarin';
            } else {
                return `${diffDays} hari yang lalu`;
            }
        }
        
        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
        
        // Update icons when page is shown
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                lucide.createIcons();
            }
        });
    </script>
</body>
</html>